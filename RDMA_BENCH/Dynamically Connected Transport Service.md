# [New Tech] Dynamically Connected Transport Service
## [介绍]
这次介绍Mellanox公司在2009年申请的一项专利，动态链接传输服务，用来解决RDMA网卡可扩展性的新型传输方案。相比于之前引入的XRC传输，DCT通过动态资源分配再一次减少网卡资源的消耗，增强了RDMA的可扩展性。下面的内容就介绍DCT是如何工作的以及相应的优缺点。

## [XRC简介]
在“Supplement to Infiniband Architecture Specification Volume 1.2.1, Annex A14 : Extended Reliable Connected (XRC) Transport Service, 2009, Revision 1.0"中，Extended Reliable Connected (XRC) Transport Service 被加入到标准规范中。XRC允许单个receive QP被多个SRQ共享，这些SRQ被运行在特定主机上一个或多个进程共享。因此，每个进程可以只维护到每个远端主机的单个QP，而不用维护到每个远端进程的单个QP。一个receive QP与每一个远端send QP对应，并且可以被主机上面的所有进程共享。

## [DCT概览]
在InfiniBand网络的节点上执行的进程使用基于队列的模型相互通信。 发送和接收进程建立一个队列对（QP），它由发送队列（SQ）和接收队列（RQ）组成。 主机发送和接收工作请求（WR），产生工作队列元素（WQE）被加载到这些队列中以供InfiniBand通道适配器处理。 要在QP上接收消息，接收缓冲区将加载到该QP。

在下文描述的本发明中，采用动态连接（DC）传输服务来减少每个端节点所需的QP的数量，同时保留RC语义。 DC传输服务提供类似数据报的模型，允许DC QP到达多个远程节点中的多个远程进程。提交给DC发送队列的每个WR包括标识目标远程目标进程的信息。然后，DC上下文通过网络彼此动态地绑定，以创建用于可靠地传递一个或多个消息的动态RC等效连接。当发起方到达其发送队列中的一个点时，要么没有其他WQE要执行，要么下一个WQE指向另一个进程（可能在不同的节点中），然后动态连接被拆除。然后可以使用相同的DC上下文来建立到另一个目的地进程的新动态连接。

由本发明提供的DC传输服务使得每个进程能够维持其专有拥有的其自己的一组专用DC上下文。 DC传输服务允许每个DC传输上下文以多个远程节点中的多个远程进程为目标。 为了提供可靠的传递语义，DC上下文通过网络动态地相互绑定，以创建临时的RC等效连接，用于可靠地传递一个或多个消息。 通道适配器通过连接本身传输数据包而不需要单独的信令过程来在带内创建动态连接。 这种带内连接方法支持对后续数据通信流量进行流水线操作，从而消除了3次握手的延迟成本。 完成为特定目标发布的所有消息后，DC连接将被拆除，DC上下文可用于新连接。

使用DC传输服务，每个节点在集群内完全连接所需的DC连接上下文的数量不受集群大小的影响。 每个进程通常需要多个DC上下文，其顺序为进程可以并行驱动的连接数，以及用于处理入站请求的附加DC上下文。 因此，每个端节点所需的DC上下文数由每个相应端节点的能力驱动。

由于DC传输服务允许类似数据报的连接模型（在连接的上下文中），因此在处理DC时应修改传统的QP概念。 DC发起者和响应者上下文可以被视为独立实体，它们不是成对绑定的，甚至不是如此创建的。 当DC发起器连接到给定远程节点处的DC响应器时，并不意味着必须同时在反向方向上存在互补连接。 DC的这一特性允许进程独立地确定它所需的DC发起器和DC响应器上下文的数量，以满足其连接要求。 它还简化了DC连接语义，因为它们是严格one-sided的。